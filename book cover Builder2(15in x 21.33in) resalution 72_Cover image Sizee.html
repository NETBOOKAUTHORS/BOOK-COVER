<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Book Cover Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }

    canvas {
      border: 1px solid #ccc;
      margin-top: 20px;
      background: #fff;
    }

    label,
    input,
    select,
    button {
      display: block;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h2>Book Cover Creator</h2>

  <label>Upload Cover Image:</label>
  <input type="file" id="imageUpload" accept="image/*" />

  <label>Book Title (Sinhala):</label>
  <input type="text" id="titleSi" value="කලු තාර පටියා" />

  <label>Book Title (English):</label>
  <input type="text" id="titleEn" value="KALU THARA PATIYA" />

  <label>Author Name:</label>
  <input type="text" id="author" value="A.U Samadhi Niroshani" />

  <hr />

  <label>Font Color:</label>
  <input type="color" id="fontColor" value="#000000" />

  <label>Bottom Author Text Color:</label>
  <input type="color" id="authorColor" value="#000000" />

  <label>Font Family:</label>
  <select id="fontFamily">
    <option value="Arial">Arial</option>
    <option value="Georgia">Georgia</option>
    <option value="Courier New">Courier New</option>
    <option value="Times New Roman">Times New Roman</option>
    <option value="Noto Serif">Noto Serif</option>
  </select>

  <label>Author Font Size:</label>
  <input type="number" id="authorSize" value="12" min="10" max="36" /> px

  <label>Title Font Size (Sinhala):</label>
  <input type="number" id="titleSiSize" value="16" min="10" max="36" /> px

  <label>Title Font Size (English):</label>
  <input type="number" id="titleEnSize" value="14" min="10" max="36" /> px

  <label>Enable Drop Shadow:</label>
  <input type="checkbox" id="textShadow" checked />

  <label>Red Bar Width (px):</label>
  <input type="number" id="barWidth" value="30" min="10" max="100" />

  <label>Spacing Between Text Blocks on Red Bar (px):</label>
  <input type="number" id="barSpacing" value="20" min="0" max="500" />

  <label>Red Bar Color:</label>
  <input type="color" id="barColor" value="#d0021b" />

  <hr />

  <button onclick="generateCover()">Generate Cover</button>
  <button onclick="savePNG()">Save as PNG</button>

  <canvas id="coverCanvas" width="365" height="510"></canvas>

  <script>
    const canvas = document.getElementById("coverCanvas");
    const ctx = canvas.getContext("2d");
    let uploadedImg = null;

    document.getElementById("imageUpload").addEventListener("change", function (e) {
      const reader = new FileReader();
      reader.onload = function (event) {
        uploadedImg = new Image();
        uploadedImg.onload = generateCover;
        uploadedImg.src = event.target.result;
      };
      reader.readAsDataURL(e.target.files[0]);
    });

    function generateCover() {
      const titleSi = document.getElementById("titleSi").value;
      const titleEn = document.getElementById("titleEn").value;
      const author = document.getElementById("author").value;

      const fontColor = document.getElementById("fontColor").value;
      const authorColor = document.getElementById("authorColor").value;
      const barWidth = parseInt(document.getElementById("barWidth").value);
      const barColor = document.getElementById("barColor").value;
      const fontFamily = document.getElementById("fontFamily").value;
      const shadow = document.getElementById("textShadow").checked;

      const sizeAuthor = parseInt(document.getElementById("authorSize").value);
      const sizeTitleSi = parseInt(document.getElementById("titleSiSize").value);
      const sizeTitleEn = parseInt(document.getElementById("titleEnSize").value);
      const spacing = parseInt(document.getElementById("barSpacing").value);

      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Outer gray border
      ctx.fillStyle = "#ccc";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Background gradient
      const padding = 10;
      const innerX = padding;
      const innerY = padding;
      const innerWidth = canvas.width - padding * 2;
      const innerHeight = canvas.height - padding * 2;
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, "#fff7d1");
      gradient.addColorStop(1, "#fef6dc");
      ctx.fillStyle = gradient;
      ctx.fillRect(innerX, innerY, innerWidth, innerHeight);

      // Draw uploaded image
      if (uploadedImg) {
        const imgAspect = uploadedImg.width / uploadedImg.height;
        const canvasAspect = innerWidth / innerHeight;

        let drawWidth, drawHeight, drawX, drawY;

        if (imgAspect > canvasAspect) {
          drawWidth = innerWidth;
          drawHeight = innerWidth / imgAspect;
          drawX = innerX;
          drawY = innerY + (innerHeight - drawHeight) / 2;
        } else {
          drawHeight = innerHeight;
          drawWidth = innerHeight * imgAspect;
          drawX = innerX + (innerWidth - drawWidth) / 2;
          drawY = innerY;
        }

        ctx.drawImage(uploadedImg, drawX, drawY, drawWidth, drawHeight);
      }

      // Red bar
      ctx.fillStyle = barColor;
      ctx.fillRect(0, 0, barWidth, canvas.height);

      // Drop shadow
      if (shadow) {
        ctx.shadowColor = "rgba(0,0,0,0.4)";
        ctx.shadowBlur = 4;
        ctx.shadowOffsetX = 1;
        ctx.shadowOffsetY = 1;
      } else {
        ctx.shadowColor = "transparent";
        ctx.shadowBlur = 0;
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 0;
      }

      // Red bar text blocks (vertical)
      ctx.save();
      ctx.textAlign = "center";
      ctx.fillStyle = "white";

      const texts = [
        { text: author, size: sizeAuthor, font: `bold ${sizeAuthor}px ${fontFamily}` },
        { text: titleEn, size: sizeTitleEn, font: `${sizeTitleEn}px ${fontFamily}` },
        { text: titleSi, size: sizeTitleSi, font: `bold ${sizeTitleSi}px ${fontFamily}` },
      ];

      let totalHeight = 0;
      texts.forEach(t => {
        ctx.font = t.font;
        const metrics = ctx.measureText(t.text);
        t.height = metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent || t.size;
        totalHeight += t.height;
      });
      totalHeight += spacing * (texts.length - 1);

      let currentY = (canvas.height - totalHeight) / 2;

      texts.forEach(t => {
        ctx.save();
        ctx.font = t.font;
        ctx.translate(barWidth / 2 + 1, currentY + t.height / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.fillText(t.text, 0, 0);
        ctx.restore();
        currentY += t.height + spacing;
      });

      ctx.restore();

      // Top & bottom main texts
      ctx.fillStyle = fontColor;
      ctx.textAlign = "center";

      ctx.font = `bold ${sizeTitleSi + 4}px ${fontFamily}`;
      ctx.fillText(titleSi, canvas.width / 2 + 10, 40);

      ctx.font = `${sizeTitleEn}px ${fontFamily}`;
      ctx.fillText(titleEn, canvas.width / 2 + 10, 65);

      // Bottom author text in custom color
      ctx.fillStyle = authorColor;
      ctx.font = `${sizeAuthor}px ${fontFamily}`;
      ctx.fillText("written by", canvas.width / 2 + 10, 435);

      ctx.font = `bold ${sizeAuthor + 2}px ${fontFamily}`;
      ctx.fillText(author, canvas.width / 2 + 10, 460);
    }

    function savePNG() {
      const link = document.createElement("a");
      link.download = "book-cover.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }
  </script>
</body>
</html>
